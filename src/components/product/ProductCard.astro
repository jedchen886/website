---
import { Image } from 'astro:assets';

interface FeatureItem {
  text: string;
  icon?: 'lift' | 'data' | 'multimodal' | 'ecosystem' | 'wheels' | 'camera' | 'outdoor' | 'ai' | 'dora' | 'lowcost' | 'opensource' | 'simulation' | 'agile' | 'compact';
}

interface Props {
  /** Product image */
  image: ImageMetadata;
  /** Alt text for product image */
  imageAlt: string;
  /** Product title */
  title: string;
  /** Product description */
  description: string;
  /** List of feature items with text and optional icon type */
  features: (string | FeatureItem)[];
  /** CTA button text */
  ctaText?: string;
  /** CTA button link */
  ctaLink: string;
  /** Image position: 'left' or 'right' */
  imagePosition?: 'left' | 'right';
  /** Custom container class */
  containerClass?: string;
  /** Custom title class */
  titleClass?: string;
  /** Custom description class */
  descriptionClass?: string;
  /** Custom button class */
  buttonClass?: string;
  /** Use gradient background */
  useGradient?: boolean;
}

const {
  image,
  imageAlt,
  title,
  description,
  features,
  ctaText = '了解更多',
  ctaLink,
  imagePosition = 'left',
  containerClass = '',
  titleClass = '',
  descriptionClass = '',
  buttonClass = 'cta-btn-gradient',
  useGradient = true,
} = Astro.props;

// Determine order classes based on image position
const imageOrderClass = imagePosition === 'left' ? 'order-1 sm:order-1' : 'order-1 sm:order-2';
const contentOrderClass = imagePosition === 'left' ? 'order-2 sm:order-2' : 'order-2 sm:order-1';

// Gradient-aware classes (light gradient - dark text)
const cardBgClass = useGradient ? 'product-card-gradient' : '';
const defaultTitleClass = 'text-2xl md:text-3xl text-center md:text-start tracking-tight text-gray-800 font-bold';
const defaultDescClass = 'text-base md:text-lg mt-4 leading-relaxed text-slate-600';

// Helper to get feature text and icon
const getFeatureData = (feature: string | FeatureItem) => {
  if (typeof feature === 'string') {
    return { text: feature, icon: 'default' };
  }
  return { text: feature.text, icon: feature.icon || 'default' };
};

// SVG icons map
const iconSvgs: Record<string, string> = {
  // Lifting arm - wider scenarios
  lift: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
    <path d="M12 22V8"/>
    <path d="M5 12H2a10 10 0 0020 0h-3"/>
    <path d="M8 8l4-4 4 4"/>
    <circle cx="12" cy="4" r="1"/>
  </svg>`,
  // Data collection
  data: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
    <path d="M12 2v4"/>
    <path d="M12 18v4"/>
    <path d="M4.93 4.93l2.83 2.83"/>
    <path d="M16.24 16.24l2.83 2.83"/>
    <path d="M2 12h4"/>
    <path d="M18 12h4"/>
    <path d="M4.93 19.07l2.83-2.83"/>
    <path d="M16.24 7.76l2.83-2.83"/>
    <circle cx="12" cy="12" r="4"/>
  </svg>`,
  // Multimodal - voice & video
  multimodal: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
    <path d="M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3z"/>
    <path d="M19 10v2a7 7 0 01-14 0v-2"/>
    <line x1="12" y1="19" x2="12" y2="23"/>
    <line x1="8" y1="23" x2="16" y2="23"/>
  </svg>`,
  // Ecosystem support
  ecosystem: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="12" cy="12" r="3"/>
    <path d="M12 1v4"/>
    <path d="M12 19v4"/>
    <path d="M1 12h4"/>
    <path d="M19 12h4"/>
    <path d="M4.22 4.22l2.83 2.83"/>
    <path d="M16.95 16.95l2.83 2.83"/>
    <path d="M4.22 19.78l2.83-2.83"/>
    <path d="M16.95 7.05l2.83-2.83"/>
  </svg>`,
  // Wheels/mobility
  wheels: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="5" cy="17" r="3"/>
    <circle cx="19" cy="17" r="3"/>
    <path d="M8 17h8"/>
    <path d="M5 14V9a2 2 0 012-2h10a2 2 0 012 2v5"/>
    <path d="M10 7V4"/>
    <path d="M14 7V4"/>
  </svg>`,
  // Camera/vision
  camera: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
    <path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/>
    <circle cx="12" cy="13" r="4"/>
  </svg>`,
  // Outdoor/terrain
  outdoor: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
    <path d="M3 20l5-10 4 6 3-4 6 8"/>
    <circle cx="18" cy="6" r="2"/>
  </svg>`,
  // AI/brain
  ai: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
    <path d="M12 2a8 8 0 018 8c0 2.5-1.5 4.5-3 6-1.5 1.5-2 3-2 5h-6c0-2-.5-3.5-2-5-1.5-1.5-3-3.5-3-6a8 8 0 018-8z"/>
    <path d="M9 21h6"/>
    <path d="M10 24h4"/>
    <path d="M12 6v4"/>
    <path d="M10 10h4"/>
  </svg>`,
  // DORA/development
  dora: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
    <polyline points="16 18 22 12 16 6"/>
    <polyline points="8 6 2 12 8 18"/>
    <line x1="12" y1="2" x2="12" y2="22"/>
  </svg>`,
  // Low cost
  lowcost: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="12" cy="12" r="10"/>
    <path d="M12 6v12"/>
    <path d="M15 9.5c0-1.5-1.5-2.5-3-2.5s-3 1-3 2.5 1.5 2 3 2.5 3 1 3 2.5-1.5 2.5-3 2.5-3-1-3-2.5"/>
  </svg>`,
  // Open source
  opensource: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
    <path d="M2 17l10 5 10-5"/>
    <path d="M2 12l10 5 10-5"/>
  </svg>`,
  // Simulation
  simulation: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
    <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
    <line x1="8" y1="21" x2="16" y2="21"/>
    <line x1="12" y1="17" x2="12" y2="21"/>
    <path d="M7 10l3 3 7-7"/>
  </svg>`,
  // Agile/flexible
  agile: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
  </svg>`,
  // Compact
  compact: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
    <rect x="4" y="4" width="16" height="16" rx="2"/>
    <path d="M9 9h6v6H9z"/>
    <path d="M4 12h5"/>
    <path d="M15 12h5"/>
    <path d="M12 4v5"/>
    <path d="M12 15v5"/>
  </svg>`,
  // Default checkmark
  default: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
    <polyline points="22 4 12 14.01 9 11.01"/>
  </svg>`
};
---

<div class={`product-card-section ${cardBgClass} ${containerClass}`}>
  <div class="max-w-6xl mx-auto px-4 sm:px-6 py-16 md:py-20">
    <div class="grid sm:grid-cols-2 gap-8 md:gap-12 items-center">
      <!-- Image -->
      <div class={`relative ${imageOrderClass} flex justify-center`}>
        <div class="product-image-wrapper">
          <Image
            format="avif"
            src={image}
            alt={imageAlt}
            loading="lazy"
            class="product-image"
          />
        </div>
      </div>

      <!-- Content Box -->
      <div class={`${contentOrderClass} px-4 sm:px-0`}>
        <div class="product-text-box">
          <h3 class={titleClass || defaultTitleClass}>
            {title}
          </h3>
          <p class={descriptionClass || defaultDescClass}>
            {description}
          </p>

          <!-- Feature Boxes Grid -->
          <div class="grid grid-cols-2 gap-3 mt-6">
            {features.map((feature) => {
              const { text, icon } = getFeatureData(feature);
              const svgContent = iconSvgs[icon] || iconSvgs.default;
              return (
                <div class="feature-box">
                  <div class="feature-icon" set:html={svgContent} />
                  <span class="feature-text">{text}</span>
                </div>
              );
            })}
          </div>

          <div class="mt-6 flex justify-center">
            <a href={ctaLink} class={`${buttonClass} product-card-btn`}>
              <span>{ctaText}</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
